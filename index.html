<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Attendance</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:#fff;
}

.app{
  padding:16px;
  max-width:720px;
  margin:auto;
}

h2{text-align:center}

.glass{
  background:rgba(255,255,255,.65);
  backdrop-filter:blur(14px);
  border:1px solid rgba(0,0,0,.08);
  border-radius:16px;
}

button,input{
  font-size:16px;
  padding:14px;
  border-radius:14px;
  border:1px solid rgba(0,0,0,.08);
  background:rgba(255,255,255,.65);
}

button:active{
  transform:scale(.95);
  box-shadow:inset 0 2px 6px rgba(0,0,0,.2);
}

.top{display:flex;gap:8px}
input{flex:1}

.card{padding:14px;margin-top:14px}
.subject{font-weight:600}

.actions{display:flex;gap:8px;margin-top:8px}
.present{color:#34c759}
.absent{color:#ff3b30}
.holiday{color:#ff9500}

.counts{font-size:13px;color:#666;margin-top:4px}

.calendar{
  margin-top:10px;
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:4px;
  font-size:12px;
}

.day{
  text-align:center;
  padding:6px 0;
  border-radius:8px;
}

.P{background:#d9fbe5}
.A{background:#ffdede}
.H{background:#fff1cc}
.today{border:2px solid #007aff}
</style>
</head>

<body>
<div class="app">
<h2>Attendance</h2>

<div class="top">
  <input id="subInput" placeholder="Add subject">
  <button onclick="addSubject()">＋</button>
</div>

<div id="list"></div>
</div>

<script>
const today = new Date().toISOString().split("T")[0];
let data = JSON.parse(localStorage.getItem("att")) || [];

function save(){ localStorage.setItem("att",JSON.stringify(data)); }

function addSubject(){
  const name=subInput.value.trim();
  if(!name) return;
  data.push({name, records:{}});
  subInput.value="";
  save(); render();
}

function mark(i,val){
  data[i].records[today]=val;
  save(); render();
}

function undo(i){
  delete data[i].records[today];
  save(); render();
}

function render(){
  list.innerHTML="";
  data.forEach((s,i)=>{
    const rec=s.records;
    let p=0,a=0;
    Object.values(rec).forEach(v=>{
      if(v==="P")p++;
      if(v==="A")a++;
    });

    const total=p+a;
    const percent= total?((p/total)*100).toFixed(1):0;

    let cal="";
    Object.keys(rec).slice(-21).forEach(d=>{
      const cls=rec[d];
      cal+=`<div class="day ${cls} ${d===today?'today':''}">${d.split("-")[2]}</div>`;
    });

    const todayState=rec[today];

    list.innerHTML+=`
    <div class="card glass">
      <div class="subject">${s.name}</div>
      <div class="counts">✔ ${p} &nbsp; ✖ ${a} &nbsp; ${percent}%</div>

      <div class="actions">
        <button class="present" onclick="mark(${i},'P')" ${todayState?'disabled':''}>Present</button>
        <button class="absent" onclick="mark(${i},'A')" ${todayState?'disabled':''}>Absent</button>
        <button class="holiday" onclick="mark(${i},'H')" ${todayState?'disabled':''}>Holiday</button>
        <button onclick="undo(${i})">↶</button>
      </div>

      <div class="calendar">${cal}</div>
    </div>`;
  });
}
render();
</script>
</body>
</html>

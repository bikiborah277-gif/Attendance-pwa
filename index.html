<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Attendance PWA</title>

<style>
:root{
  --glass: rgba(255,255,255,0.18);
  --blur: blur(14px);
}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:#0f172a;
  color:white;
  display:flex;
  justify-content:center;
}
.app{
  width:100%;
  max-width:420px;
  padding:14px;
}
.card{
  background:var(--glass);
  backdrop-filter:var(--blur);
  border-radius:20px;
  padding:16px;
  margin-bottom:14px;
}
h2{
  margin:0 0 10px;
  font-size:18px;
}
.stats{
  display:flex;
  justify-content:space-between;
  font-size:14px;
  opacity:.9;
}
.buttons{
  display:flex;
  gap:10px;
  margin-top:12px;
}
button{
  flex:1;
  padding:14px;
  border:none;
  border-radius:16px;
  background:rgba(255,255,255,0.25);
  color:white;
  font-size:15px;
  backdrop-filter:var(--blur);
  transition:transform .1s, background .2s;
}
button:active{
  transform:scale(.94);
  background:rgba(255,255,255,0.4);
}
button:disabled{
  opacity:.4;
}
.calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;
  font-size:12px;
}
.cal-header{
  text-align:center;
  opacity:.7;
}
.day{
  text-align:center;
  padding:8px 0;
  border-radius:10px;
}
.today{
  outline:1px solid #38bdf8;
}
.P{ background:#22c55e; }
.A{ background:#ef4444; }
.H{ background:#f59e0b; }
</style>
</head>

<body>
<div class="app">

<div class="card">
  <h2 id="todayText"></h2>
  <div class="stats">
    <div>Present: <span id="pCount">0</span></div>
    <div>Absent: <span id="aCount">0</span></div>
  </div>

  <div class="buttons">
    <button id="presentBtn">Present</button>
    <button id="absentBtn">Absent</button>
    <button id="holidayBtn">Holiday</button>
  </div>
</div>

<div class="card">
  <h2>Calendar</h2>
  <div class="calendar" id="calendar"></div>
</div>

</div>

<script>
const data = JSON.parse(localStorage.getItem("attendance")||"{}");
const holidays = JSON.parse(localStorage.getItem("holidays")||"{}");

const today = new Date();
const todayStr = today.toISOString().split("T")[0];
const isSunday = today.getDay()===0;

document.getElementById("todayText").textContent =
  today.toDateString();

function save(){
  localStorage.setItem("attendance",JSON.stringify(data));
  localStorage.setItem("holidays",JSON.stringify(holidays));
}

function updateStats(){
  let p=0,a=0;
  for(const d in data){
    if(data[d]==="P") p++;
    if(data[d]==="A") a++;
  }
  pCount.textContent=p;
  aCount.textContent=a;
}

function updateButtons(){
  const marked = data[todayStr];
  const isHoliday = holidays[todayStr] || isSunday;
  presentBtn.disabled = absentBtn.disabled = isHoliday || marked;
}

presentBtn.onclick=()=>{
  data[todayStr]="P"; save(); render();
};
absentBtn.onclick=()=>{
  data[todayStr]="A"; save(); render();
};
holidayBtn.onclick=()=>{
  holidays[todayStr]=true;
  save(); render();
};

function renderCalendar(){
  const cal = document.getElementById("calendar");
  cal.innerHTML="";

  ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(d=>{
    const h=document.createElement("div");
    h.textContent=d;
    h.className="cal-header";
    cal.appendChild(h);
  });

  const year=today.getFullYear();
  const month=today.getMonth();
  const first=new Date(year,month,1).getDay();
  const days=new Date(year,month+1,0).getDate();

  for(let i=0;i<first;i++){
    cal.appendChild(document.createElement("div"));
  }

  for(let d=1;d<=days;d++){
    const cell=document.createElement("div");
    cell.className="day";
    const date=new Date(year,month,d);
    const key=date.toISOString().split("T")[0];
    cell.textContent=d;

    if(key===todayStr) cell.classList.add("today");
    if(date.getDay()===0 || holidays[key]) cell.classList.add("H");
    if(data[key]) cell.classList.add(data[key]);

    cal.appendChild(cell);
  }
}

function render(){
  updateButtons();
  updateStats();
  renderCalendar();
}

render();
</script>

</body>
</html>

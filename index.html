<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Attendance</title>

<style>
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:linear-gradient(160deg,#0f172a,#020617);
  color:#fff;
  min-height:100vh;
}
.app{
  max-width:420px;
  margin:auto;
  padding:16px;
}
.top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:14px;
}
.add-subject{
  display:flex;
  gap:8px;
  margin-bottom:16px;
}
.add-subject input{
  flex:1;
  padding:12px 16px;
  border:none;
  border-radius:18px;
  background:rgba(255,255,255,0.08);
  color:white;
  outline:none;
  backdrop-filter:blur(10px);
}
.add-subject button{
  width:40px;height:40px;
  border-radius:50%;
  border:none;
  font-size:20px;
  background:rgba(255,255,255,0.1);
  color:white;
  backdrop-filter:blur(10px);
}
.btn.holiday{
  border:none;
  border-radius:18px;
  padding:10px 16px;
  background:rgba(255,255,255,0.08);
  color:white;
  backdrop-filter:blur(10px);
}
.btn.holiday.active{
  background:#f59e0b;
  color:#000;
}

.card{
  background:rgba(255,255,255,0.05);
  border-radius:22px;
  padding:14px 16px;
  margin-bottom:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.subject-name{
  font-weight:500;
}
.stats{
  display:flex;
  gap:8px;
  margin-top:4px;
  font-size:12px;
  opacity:.85;
}
.stats span{
  padding:4px 8px;
  border-radius:10px;
  background:rgba(255,255,255,0.08);
}

.actions button{
  width:34px;height:34px;
  border-radius:50%;
  border:none;
  margin-left:6px;
  font-weight:bold;
  color:white;
  backdrop-filter:blur(8px);
}
.p{background:rgba(34,197,94,.8);}
.a{background:rgba(239,68,68,.8);}
.u{background:rgba(100,116,139,.8);}
.disabled{opacity:.3;pointer-events:none;}
</style>
</head>

<body>
<div class="app">

  <div class="top">
    <strong id="dateLabel"></strong>
    <button class="btn holiday" id="holidayBtn">Holiday</button>
  </div>

  <div class="add-subject">
    <input id="subjectInput" placeholder="Add subject">
    <button id="addSubjectBtn">+</button>
  </div>

  <div id="subjects"></div>
</div>

<script>
const today = new Date();
const dayKey = today.toISOString().slice(0,10);

let store = JSON.parse(localStorage.getItem("attendance") || "{}");
store[dayKey] ??= { holiday:false, subjects:{} };

const dateLabel = document.getElementById("dateLabel");
dateLabel.textContent = today.toDateString();

const subjectsDiv = document.getElementById("subjects");
const subjectInput = document.getElementById("subjectInput");
const addBtn = document.getElementById("addSubjectBtn");
const holidayBtn = document.getElementById("holidayBtn");

function save(){
  localStorage.setItem("attendance", JSON.stringify(store));
}

function render(){
  holidayBtn.classList.toggle("active", store[dayKey].holiday);
  subjectsDiv.innerHTML = "";

  for(const name in store[dayKey].subjects){
    const s = store[dayKey].subjects[name];

    const card = document.createElement("div");
    card.className = "card";

    const left = document.createElement("div");
    left.innerHTML = `
      <div class="subject-name">${name}</div>
      <div class="stats">
        <span>P ${s.p}</span>
        <span>A ${s.a}</span>
      </div>
    `;

    const actions = document.createElement("div");
    actions.className = "actions";

    const pBtn = document.createElement("button");
    pBtn.textContent = "P";
    pBtn.className = "p";
    pBtn.classList.toggle("disabled", s.today || store[dayKey].holiday);
    pBtn.onclick = () => {
      s.p++;
      s.last = "P";
      s.today = true;
      save(); render();
    };

    const aBtn = document.createElement("button");
    aBtn.textContent = "A";
    aBtn.className = "a";
    aBtn.classList.toggle("disabled", s.today || store[dayKey].holiday);
    aBtn.onclick = () => {
      s.a++;
      s.last = "A";
      s.today = true;
      save(); render();
    };

    const uBtn = document.createElement("button");
    uBtn.textContent = "â†º";
    uBtn.className = "u";
    uBtn.classList.toggle("disabled", !s.today || store[dayKey].holiday);
    uBtn.onclick = () => {
      if(s.last === "P") s.p--;
      if(s.last === "A") s.a--;
      s.today = false;
      s.last = null;
      save(); render();
    };

    actions.append(pBtn, aBtn, uBtn);
    card.append(left, actions);
    subjectsDiv.appendChild(card);
  }
}

function addSubject(){
  const name = subjectInput.value.trim();
  if(!name || store[dayKey].subjects[name]) return;

  store[dayKey].subjects[name] = {
    p:0,
    a:0,
    today:false,
    last:null
  };
  subjectInput.value = "";
  save(); render();
}

addBtn.onclick = addSubject;
subjectInput.onkeydown = e => e.key === "Enter" && addSubject();

holidayBtn.onclick = () => {
  store[dayKey].holiday = !store[dayKey].holiday;
  save(); render();
};

render();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Offline Attendance</title>
<style>
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:linear-gradient(160deg,#0f172a,#020617);
  color:#fff;
  min-height:100vh;
}
.app{
  max-width:420px;
  margin:auto;
  padding:16px;
}
.card{
  background:rgba(255,255,255,0.08);
  border-radius:22px;
  padding:16px;
  margin-bottom:16px;
}
.top{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.btn{
  border:none;
  border-radius:18px;
  padding:12px 16px;
  font-size:15px;
  background:rgba(255,255,255,0.15);
  color:white;
}
.btn:active{transform:scale(.96);}
.btn.holiday.active{background:#f59e0b;color:#000;}
.stats{
  display:flex;
  justify-content:space-between;
  margin-top:10px;
  font-size:14px;
}
.actions{
  display:flex;
  justify-content:space-between;
  margin-top:16px;
}
.actions button{
  flex:1;
  margin:0 5px;
  padding:12px 0;
  border-radius:18px;
  border:none;
  font-size:16px;
}
.p{background:#22c55e;}
.a{background:#ef4444;}
.u{background:#64748b;}
.disabled{opacity:.4;pointer-events:none;}

.subject{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}
.subject-name{
  font-weight:bold;
}
</style>
</head>

<body>
<div class="app">
  <div class="card top">
    <strong id="dateLabel"></strong>
    <button class="btn" id="addSubjectBtn">+ Add Subject</button>
  </div>

  <div id="subjects"></div>
</div>

<script>
const today=new Date();
const key=today.toISOString().slice(0,10);

// Load data from localStorage
let store = JSON.parse(localStorage.getItem("attendance")||"{}");
store[key] = store[key] || { subjects: {} };

const dateLabel = document.getElementById("dateLabel");
dateLabel.textContent = today.toDateString();

const subjectsDiv = document.getElementById("subjects");
const addSubjectBtn = document.getElementById("addSubjectBtn");

function save() { localStorage.setItem("attendance", JSON.stringify(store)); }

function render() {
  subjectsDiv.innerHTML = '';
  const subjects = store[key].subjects;
  for(const subj in subjects) {
    const data = subjects[subj];

    const card = document.createElement('div');
    card.className = 'card subject';

    const name = document.createElement('span');
    name.className = 'subject-name';
    name.textContent = subj;

    const statDiv = document.createElement('div');
    statDiv.className = 'actions';

    const holidayBtn = document.createElement('button');
    holidayBtn.className = 'btn holiday';
    holidayBtn.textContent = 'Holiday';
    holidayBtn.classList.toggle('active', data.holiday);

    const presentBtn = document.createElement('button');
    presentBtn.className = 'p';
    presentBtn.textContent = 'P';
    presentBtn.classList.toggle('disabled', data.status || data.holiday);

    const absentBtn = document.createElement('button');
    absentBtn.className = 'a';
    absentBtn.textContent = 'A';
    absentBtn.classList.toggle('disabled', data.status || data.holiday);

    const undoBtn = document.createElement('button');
    undoBtn.className = 'u';
    undoBtn.textContent = 'â†º';
    undoBtn.classList.toggle('disabled', !data.status || data.holiday);

    // Event listeners
    holidayBtn.onclick = () => {
      data.holiday = !data.holiday;
      if(data.holiday) data.status = null;
      save(); render();
    }
    presentBtn.onclick = () => { data.status = 'P'; save(); render(); }
    absentBtn.onclick = () => { data.status = 'A'; save(); render(); }
    undoBtn.onclick = () => { data.status = null; save(); render(); }

    statDiv.append(presentBtn, absentBtn, undoBtn, holidayBtn);
    card.append(name, statDiv);
    subjectsDiv.appendChild(card);
  }
}

addSubjectBtn.onclick = () => {
  const name = prompt("Enter subject name:");
  if(!name) return;
  store[key].subjects[name] = { status:null, holiday:false };
  save(); render();
}

render();
</script>
</body>
</html>
